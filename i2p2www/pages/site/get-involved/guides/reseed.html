{% extends "global/layout.html" %}
{% block title %}{{ _('How to Set up a Reseed Server') }}{% endblock %}
{% block lastupdated %}2021-11{% endblock %}
{% block content %}

<h2>{% trans %}Overview{% endtrans %}</h2>

<p>{% trans -%}
Thank you for volunteering to run an I2P reseed server.
"Reseeding" is our term for bootstrapping new routers into the network.
New routers fetch a bundle of peer references, or "router infos", from one or more of a hardcoded list of HTTPS URLs.
{%- endtrans %}</p>

<h2>{% trans %}Requirements{% endtrans %}</h2>

<p>{% trans -%}
At its simplest, a reseed server consists of a Java I2P router, an HTTPS web server,
and some scripts that periodically gather router infos from the router,
bundle and sign them into a custom file format, and deliver these files over HTTPS.
In practice, it's a bit more complex, and a reseed operator must be fairly competent and attentive.
A reseed server is not appropriate for a residential internet connection. The complexities include:
{%- endtrans %}</p>

<ul>
<li>{% trans -%}
You must have a secure SSL setup with either a self-signed certificate or a cert that chains up to a standard CA
{%- endtrans %}</li>
<li>{% trans -%}
The SSL configuration must conform to current best practices on allowed ciphers and protocols, and the CN/SAN host name must match the URL
{%- endtrans %}</li>
<li>{% trans -%}
The scripts are designed to deliver different router info bundles to different requestors for network diversity
{%- endtrans %}</li>
<li>{% trans -%}
The scripts are designed to deliver the same bundle to the same repeated requestor to prevent scraping
{%- endtrans %}</li>
<li>{% trans -%}
The reseed servers are under periodic attacks and DDoS attempts, and from other buggy I2P implementations and botnets.
This necessitates that you run fail2ban or an equivalent solution.
{%- endtrans %}</li>
</ul>

<h2>{% trans %}Information Required{% endtrans %}</h2>

<p>{% trans -%}
When your setup is complete and ready for testing, we will need the HTTPS URL,
the SSL public key certificate (only if selfsigned), and the su3 public key certificate.
After testing is complete, these will be added to the hardcoded entries in the Java and C++ routers in the next release,
and you will start seeing traffic.
We also will need your email address so we may continue to contact you about reseed administration issues.
The email will not be made public but will be known to the other reseed operators.
You should expect that your nick or name and its association with that URL or IP will become public.
{%- endtrans %}</p>

<h2>{% trans %}Privacy Policy{% endtrans %}</h2>

<p>{% trans -%}
A reseed operator is a trusted role in the network.
While we do not yet have a formal privacy policy, you must ensure the privacy of our users
by not publicizing logs or IPs found in those logs, except as necessary to discuss administration issues with the I2P reseed team.
{%- endtrans %}</p>

<h2>{% trans %}Financial Support{% endtrans %}</h2>

<p>{% trans -%}
Modest financial support may be available to those running reseed servers.
This support would be in partial reimbursement for your server costs.
Support will not be paid in advance and will probably not cover all your expenses.
Support is only available to those who have been running reseed servers in good standing for several months, and is based on actual need.
{%- endtrans %}</p>

<p>{% trans -%}
If you would like to discuss support, please contact echelon and CC: zzz
{%- endtrans %}</p>


<h2>{% trans %}Getting Started{% endtrans %}</h2>

<p>{% trans -%}
Our reseed coordinator is "zzz" and he may be contacted at zzz at mail.i2p or zzz at i2pmail.org.
Unfortunately, he is not generally on IRC. The reseed setup is somewhat specialized, and you should direct most questions to him.
IDK is able to answer questions about the reseed software.
{%- endtrans %}</p>

<p>{% trans -%}
For actual implementation, details below. We have one recommended reseed solution:
{%- endtrans %}</p>

<ul>
<li>{% trans -%}
A Go implementation that includes the web server and all the scripts. This is the recommended solution.
{%- endtrans %}</li>
</ul>

<p>{% trans -%}
For further information, read the information at the following links, and then contact zzz.
Thank you!
{%- endtrans %}</p>

<ul>
  <li><a href="https://i2pgit.org/idk/reseed-tools">Go reseed server source on gitlab</a></li>
  <li><a href="https://github.com/eyedeekay/i2p-tools-1">Go reseed server source on github</a></li>
</li></ul>

<h2>{% trans %}Detailed Instructions{% endtrans %}</h2>

<h3>How-to Public reseed servers - su3</h3>

<ul>
<li>Some parts of this how-to are copied from <a href="http://zzz.i2p">zzz.i2p</a> and are modified.</li>
<li>Fetching individual RI (dat-files -the legacy/old style-) is not part of this how-to.</li>
</ul>

<h3>Table of contents</h3>

<ol>
<li>Introduction</li>
<li>Requirements</li>
<li>Go Solution - Quick Guide</li>
  <ol>
   <li>Run Reseed</li>
   <li>Backup Certificates and Keys</li>
   <li>Enable Autostart</li>
   <li>Connect Web Server to Reseed</li>
   <li>Test From Another Computer</li>
   <li>Send Us Your Certificates</li>
  </ol>
<li>Seamless SSL-Certificate Exchange</li>
<li>Reseed Server Domain/URL/Port Exchange</li>
<li>Tests</li>
<li>Contact Reseed Maintainer</li>
</ol>

<h2>1. Introduction</h2>
<p>
Public reseed servers are necessary to bootstrap into the Invisible Internet.
Newly installed I2P routers use reseed server to download between 75 and 100 "routerInfos"
which contain peer information which you use to make your first connections. Reseed servers
carefully distribute a subset of the routerInfos available to them in order to help new routers
join the network.
</p>
<p>
To secure bootstrap and enable a trusted start, HTTPS/TLS and signed su3-files are mandatory.
The reseed server software deals with this automatically, or you may disable the reseed's
built-in HTTPS server in favor of a reverse proxy to provide HTTPS. NGINX is a popular choice.
</p>

<h2>2. Requirements</h2>

<p>
Requirements for running a public reseed server:
<ul>
<li>Well integrated running I2P router @ 24/7</li>
<li>Server with static IPv4 (2 cpu/ 2GB ram is fine)</li>
<li>Own domain, sub-domain or an anonymous third-level domain. Alternatively, some reseed servers may operate as `.onion` sites, however
  visible internet domains are preferred.</li>
<li>A self-signed SSL certificate, or an SSL certificate from <a href="https://letsencrypt.org" target="_blank">Let's Encrypt</a></li>
<li>Enough bandwidth and traffic volume - Around 15 GB/month as of December 2016</li>
</ul>
Optional:
<ul>
<li>fail2ban to protect you from botnets</li>
<li>GnuPG/PGP for signed/encrypted emails</li>
<li>IPv6</li>
<li>Up-to-date web server or reverse proxy (Apache/nginx), HTTPS ONLY with TLS 1.2 and good ciphers</li>
<li>Tor(for `.onion` reseeds only)</li>
</ul>

<p>
This How-to is tested with Ubuntu/Debian as well as FreeBSD, but should work on any Linux, BSD, OSX, or Windows system.
</p>
<p>
The web server has to be public reachable from all over the world, unless the reseeed is intended to be `.onion` only.
Your server should be kept up-to-date and appropriately hardened against attacks using fail2ban, apparmor, IPTables, etc.
The web server doesn't need to listen at default SSL/TLS port 443 - any other port can be used for obfuscation.
</p>


<h2>3. Go Solution - Quick Guide</h2>

<h3>1. Fire Up Your Favorite Webserver</h3>
<ol><li>
	Connect a domain, sub-domain or (anonymous) third-level-domain
</li><li>
	Setup a state-of-the-art TLS(SSL) certificate
</li><li>
	Allow access only via HTTPS/TLS, no unencrypted HTTP
</li><li>
  Allow only very good ciphers, compatible to Java 7/8/9. See <a href="https://cipherli.st/" target="_blank">Cipherli.st</a>
</li></ol>
<p>
Note: A non default port other than 443 can be used; TLS certificate can be self signed; configure fail2ban as bot-net protection
</p>


<h3>2. Install git and golang-go (1.4.2 or higher)</h3>
<pre>
	Debian/Ubuntu:    sudo apt install git golang-go
        Arch:             sudo pacman -s git go
</pre>


<h3>3. Switch To User Running I2P, Fetch the i2p-tool Source Code, Build and Test it</h3>
<p>
Note: Visit http://reseed.i2p and download a pre-build x86_64 binary, so you can skip step 2+3.
</p>
<pre>
	export GOPATH=$HOME/go; mkdir $GOPATH; cd $GOPATH
	go get github.com/martin61/i2p-tools
	bin/i2p-tools -h
</pre>


<h3>4. Run i2p-tools locally, </h3>
<p>
Replace 'yourname@mail.i2p' with your email address
Replace '/home/i/.i2p/netDb' with the path to the I2P 'netDb' in the home folder of the user running I2P
</p>
<pre>
	GOPATH=$HOME/go;
        cd $GOPATH;
        bin/i2p-tools reseed --signer=yourname@mail.i2p \
                             --netdb=/home/i/.i2p/netDb \
                             --port=8443 \
                             --ip=127.0.0.1 \
                             --trustProxy
</pre>


<h3>5. Back Up New Certificates</h3>
<p>
Make a backup from the newly created su3-signing key and certificate found in $GOPATH (.crt/.pem/.crl) and keep it in a safe, password protected location
</p>


<h3>6. Enable Autostart (+restart) for i2p-tools in Your crontab</h3>
<p>
Replace '...' with the appropriate command-line arguments as in step 4
</p>
<pre>
	@reboot   GOPATH=$HOME/go; cd $GOPATH; bin/i2p-tools reseed ... &gt;/dev/null 2>&amp;1
	9 * * * * GOPATH=$HOME/go; cd $GOPATH; bin/i2p-tools reseed ... &gt;/dev/null 2>&amp;1
</pre>

<h3>7. Connect Your Webserver via Reverse-Proxy setup to the i2p-tool, Examples</h3>
<p>
<b>lighttpd is no longer supported due to a limitation with the 'X-Forwarded-For' HTTP Header. Please use Apache or nginx.</b>
</p>
<p>
	nginx configuration example:
</p>
<pre>
		location / {
			proxy_pass http://127.0.0.1:8443;
                        proxy_set_header X-Real-IP  $remote_addr;
                        proxy_set_header X-Forwarded-For $remote_addr;
		}
</pre>
<p>
	Apache (untested - feedback would be appreciated)
</p>
<pre>
		ProxyRequests Off
		&lt;Proxy *&gt;
			Order deny,allow
			Allow from all
		&lt;/Proxy&gt;
		ProxyPass / http://127.0.0.1:8443/
		ProxyPassReverse / http://127.0.0.1:8443/
</pre>
<p>
Additionally, ensure that your webserver uses these suggested settings for Strong SSL Security (visit <a href="https://cipherli.st/" target="_blank">CipherLi.st</a> for the latest settings). Sample SSL settings are provided in section <b>4.5 Reverse-Proxy Setup</b>.
</p>

<p>
Note: i2p-tool has also an build-in standalone webserver with TLS support which can be used without a webserver. Please contact (zzz at mail.i2p.de) if you need help, or stop by #i2p-dev on IRC2P and talk to other reseed operators.
</p>


<h3>8. Final Test From Another Computer With I2P Running</h3>
<ol><li>
	Place your su3-certificate (*.crt) in i2p/certificates/reseed/
</li><li>
	Place your TLS-certificate (*.crt) in i2p/certificates/ssl/
</li><li>
	Visit with your web browser http://localhost:7657/configreseed
</li><li>
	Enter your new reseed-url and delete all others, hit "Save changes and reseed now"
</li><li>
	Check the I2P logs for "Reseed got 77 router infos from ... with 0 errors, Reseed complete, 77 received"
</li></ol>


<h3>9. Send Us Your Information</h3>
<ol><li>
	Domain/URL/Port
</li><li>
	su3-signing certificate
</li><li>
	TLS certificate (if self signed)
</li></ol>
<p>
Send an email: zzz at mail.i2p, PGP signed welcome :-)

<h3>6. Convert Existing Java Keystore to crt- and pem-file</h3>

<p>
This describes how to convert your existing Java keystore with your su3 signing key to a plain crt- and pem-file.
This is only needed, when you already have a Java keystore and want to use Go solution.
If you create new keys+certs with matt's solution you can skip this chapter!

<p>
Requirements:
<ul>
<li>Java keytool
<li>openssl
<li>and of course your secret password for the keystore
</ul>

<p>
Keep in mind: the Java keystore has two passwords:
<ul>
<li>The secret key password you have entered while creating your keystore the first time (SU3File keygen ...)
<li>And a "storage" password, which is most probably default "changeit".
</ul>

<p>
This works in a Ubuntu/Debian shell:

<pre>
######################################################################################################
file="keystore.ks"
pass_jks=changeit

# List the keystore content, show the included (email) alias
keytool -list -storepass $pass_jks -keystore $file

# Convert jks --&gt; pkcs12, specify the correct email alias (xxxxx@mail.i2p):
keytool -importkeystore \
        -srcalias xxxxx@mail.i2p \
        -srckeystore $file \
        -srcstoretype jks \
        -srcstorepass $pass_jks \
        -destkeystore ${file}.p12 \
        -deststoretype pkcs12 \
        -deststorepass $pass_jks \
        -destkeypass $pass_jks

# Show the pkcs12 content:
openssl pkcs12 -passin pass:$pass_jks -in ${file}.p12 -nodes -info

# Convert pkcs12 --&gt; pem
openssl pkcs12 -passin pass:$pass_jks -in ${file}.p12 -nodes -out ${file}.pem

# Decrypt the pem
openssl rsa  -in ${file}.pem -out xxxxx_at_mail.i2p.pem

# Extract the certificate
openssl x509 -in ${file}.pem -out xxxxx_at_mail.i2p.crt
######################################################################################################
</pre>

<h3>8. Contact Reseed Maintainer</h3>

<p>
Contact us via email zzz at mail.i2p (alternatively, post in the reseed section on the zzz.i2p forum)
Provide us with details about the new
<ul>
<li>Reseed website URL
<li>Public SSL certificate
    (Only required if selfsigned, which is not recommended. Please use Lets Encrypt or other CA)
<li>Public reseed su3 certificate
<li>Your contact email
<li>A statement that you agree to the privacy policy above
</ul>
<p>
Feel free to contact zzz at mail.i2p in case of questions or problems or post your question at zzz's forum in the reseed section.

{% endblock %}
